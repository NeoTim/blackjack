// This file is part of Blackjack, a blackjack calculator and game.
//
// Copyright (C) 2015 Chen-Pang He <http://jdh8.org/>
//
// Integration by me is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Integration by me is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
function Blackjack(i,Q,p){"use asm";var q=i.Math.imul,x=i.Math.max,a=new i.Float64Array(p),c=new i.Int32Array(p),r=new i.Int16Array(p),j=new i.Int8Array(p),b=0.,u=0.,e=0,s=7752,t=7752,f=7752;function g(b,c,d){b=b|0;c=c|0;d=+d;for(;(b|0)<(c|0);b=b+8|0)a[b>>3]=d}function k(b,d,c){b=b|0;d=d|0;c=c|0;for(;(b|0)<(d|0);b=b+8|0){a[c>>3]=a[b>>3];c=c+8|0}}function n(c,d,b){c=c|0;d=+d;b=b|0;for(;(c|0)>=0;c=c-1|0){a[b>>3]=d*a[b>>3];b=b+8|0}}function v(f,b,c){f=f|0;b=b|0;c=c|0;var e=0,d=0;for(;(d|0)<(f|0);d=d+1|0){if(+a[c>>3]<+a[b>>3]){a[c>>3]=a[b>>3];e=1<<d|e}b=b+8|0;c=c+8|0}return e|0}function l(c,e,d,b){c=c|0;e=+e;d=d|0;b=b|0;for(;(c|0)>=0;c=c-1|0){a[b>>3]=e*a[d>>3]+a[b>>3];d=d+8|0;b=b+8|0}}function w(c,e,d,f,b,g){c=c|0;e=+e;d=d|0;f=f|0;b=b|0;g=g|0;for(;(c|0)>=0;c=c-1|0){a[b>>3]=e*a[d>>3]+a[b>>3];d=d+(f<<3)|0;b=b+(g<<3)|0}}function h(a){a=a|0;switch(a|0){case 1:case 10:case 11:return+b;case 7:case 8:case 9:return 1./13.}return+u}function m(c,a,b,d){c=c|0;a=a|0;b=b|0;d=d|0;for(;a;a=a-1|0){l(c,+h(a),b,d);b=b-(c<<3)|0}}function d(c,a,d,b,e){c=c|0;a=a|0;d=d|0;b=b|0;e=e|0;for(;(a|0)<(d|0);a=a+1|0){l(c,+h(a),b,e);b=b+(c<<3)|0}}function A(f){f=f|0;var c=0,e=16;g(0,1520,0.);a[115]=1.;a[121]=1.;a[127]=1.;a[133]=1.;a[139]=1.;c=880;for(;(e|0)>=11;e=e-1|0){m(5,21-e|0,1080,c);c=c-40|0}a[171]=1.;a[177]=1.;a[183]=1.;a[189]=1.;if(f&4){c=1320;e=17}else{a[165]=1.;c=1280;e=16}for(;(e|0)>=12;e=e-1|0){m(5,21-e|0,1480,c);d(5,22-e|0,11,720,c);c=c-40|0}for(c=640;(c|0)>=400;c=c-40|0){d(5,2,11,c+80|0,c);l(5,b,c+840|0,c)}for(c=0;(c|0)<360;c=c+40|0)d(5,2,11,c+400|0,c);for(c=0;(c|0)<320;c=c+40|0)l(5,b,c+1160|0,c);d(5,1,10,1120,360);if(f&8){n(5,1./(1.-b),320);n(5,1./(1.-b*4.),360)}}function B(e){e=e|0;var d=32,c=1280;g(1360,1440,1.);w(10,-1.,32,5,1360,1);if(e&8){a[178]=a[178]-b*2.;a[179]=a[179]-b*8.}for(;(c|0)>=960;c=c-80|0){k(c+80|0,c+160|0,c);w(10,-1.,d,5,c,1);d=d-8|0;w(10,-1.,d,5,c,1)}k(960,1040,880);k(880,1040,720);k(720,1040,400);k(640,1040,0);k(640,1440,1440)}function C(){var c=-1.,a=3520,b=20;for(;(b|0)>=11;b=b-1|0){c=c+ +h(21-b|0);g(a,a+80|0,c);m(10,21-b|0,2160,a);a=a-80|0}g(2240,2800,0.);for(;(b|0)>=4;b=b-1|0){d(10,2,12,a-160|0,a);a=a-80|0}a=4320;for(b=21;(b|0)>=12;b=b-1|0){m(10,21-b|0,2160,a);d(10,22-b|0,11,1440,a);a=a-80|0}n(270,2.,2240)}function D(){var f=-1.,e=5232,a=1280,c=0;for(c=20;(c|0)>=11;c=c-1|0){f=f+ +h(21-c|0);g(5120,5200,f);m(10,21-c|0,1360,5120);r[e>>1]=v(10,5120,a)|0;e=e-2|0;a=a-80|0}e=5254;a=2160;for(c=21;(c|0)>=12;c=c-1|0){g(5120,5200,0.);m(10,21-c|0,2160,5120);d(10,22-c|0,11,1440,5120);r[e>>1]=v(10,5120,a)|0;e=e-2|0;a=a-80|0}e=5212;for(a=480;(a|0)>=0;a=a-80|0){g(5120,5200,0.);d(10,2,12,a+160|0,5120);l(10,b,a+1680|0,5120);r[e>>1]=v(10,5120,a)|0;e=e-2|0}}function E(d,e,b,c){d=d|0;e=+e;b=b|0;c=c|0;for(;(d|0)>=0;d=d-1|0){a[c>>3]=e*x(a[b>>3],a[b+2240>>3])+a[c>>3];b=b+8|0;c=c+8|0}}function F(f){f=f|0;var a=0,e=0,g=2,c=0;for(;(g|0)<11;g=g+1|0){e=a+4400|0;for(c=2;(c|0)<11;c=c+1|0){o[f&1](10,+h(c),a,e);a=a+80|0}o[f&1](10,b,a+800|0,e);a=e-4320|0}d(10,1,11,1440,5120)}function G(g){g=g|0;var a=0,e=0,f=2,c=0;for(;(f|0)<11;f=f+1|0){e=a+4400|0;for(c=2;(c|0)<11;c=c+1|0){if((c|0)!=(f|0)){o[g&1](10,+h(c),a,e);a=a+80|0}}o[g&1](10,b,a+800|0,e);n(10,1./(1.-+h(f)),e);a=e-4320|0}d(10,1,10,1440,5120);n(10,1./(1.-b),5120)}function H(a){a=a|0;z[a>>1&1](a)}function I(a,c){a=a|0;c=+c;b=(10.-c)/130.;u=(10.+c)/130.;A(a);B(a);C();D();H(a)}function J(a){a=a|0;var b=1;e=5256;c[1314]=a;for(;(b|0)<=624;b=b+1|0){a=q(a^a>>30,1812433253)+b|0;c[1314+b<<2>>2]=a}}function K(){var a=0,b=0;for(;(a|0)<2496;a=a+4|0){b=c[5256+((a+4|0)%2496|0)>>2]&0x7fffffff|c[5256+a>>2]&0x80000000;c[5256+a>>2]=q(b&1,0x9908b0df)^b>>1^c[5256+((a+1588|0)%2496|0)>>2]}}function L(){var a=0;switch(e|0){case 0:J(5489);break;case 7752:K();e=5256}a=c[e>>2]|0;a=a^a>>11;a=a^a>>7&0x9d2c5680;a=a^a>>15&0xefc60000;a=a^a>>18;e=e+4|0;return a|0}function M(a,d,b){a=a|0;d=d|0;b=b|0;for(;(a|0)<(d|0);a=a+4|0){c[b>>2]=c[a>>2];b=b+4|0}}function y(a,b){a=a|0;b=b|0;var c=0;c=j[a]|0;j[a]=j[b];j[b]=c}function N(a,c,b){a=a|0;c=c|0;b=b|0;for(;(a|0)<(c|0);a=a+1|0){y(a,b);b=b+1|0}}function O(){var a=0;N(t,f,7752);t=7752;f=f-t+7752|0;for(a=s-f|0;a;a=a-1|0)y(f+a|0,f+((L()|0)%(a|0)|0)|0)}function P(b){b=b|0;var a=0;s=7752+q(b,52)|0;for(a=0;(a|0)<52;a=a+1|0)j[7752+a|0]=a;for(a=5308;(a|0)<(s|0);a=a+52|0)M(7752,7804,a);O()}var o=[l,E],z=[F,G];return{expectancy:I,decks:P}}
